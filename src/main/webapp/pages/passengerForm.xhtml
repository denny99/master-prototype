<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ice="http://www.icesoft.com/icefaces/component"
>

<ui:composition template="/pages/templates/baseTemplate.xhtml">
    <ui:define name="content">
        <HForm id="passengerData" styleClass="ice-skin-rime">
            <div class="inputFieldGroup">
                <span class="iceOutTxt headerLabel">Enter Data for Passenger ##{passengerFormBean.currentPassengerIndex + 1}</span>
            </div>
            <f:event id="multiFieldValidationEvent"
                     listener="#{passengerFormBean.validateForm}" type="postValidate"/>

            <!-- id number or passport id -->
            <HPanelGroup id="passportContainer" layout="block"
                         styleClass="contentLevelContainer blockArea">
                <div class="lFloat indented inputFieldGroup">
                    <CHhoose>
                        <!-- if other country -->
                        <CWhen test="#{bookingFormBean.selectedFlight.foreignTravel()}">
                            <!-- passport -->
                            <span class="iceOutTxt masInfoFieldLabel minindented">Passport Number:</span>
                            // TODO maxlength
                            <HInputText id="passportNumberInput" maxlength="6"
                                         value="#{passengerFormBean.currentPassenger.passportNumber}" required="true"
                                         requiredMessage="Insert your Passport Number">
                                <FAjax event="blur" listener="#{passengerFormBean.passportIdListener}" execute="@this"
                                       render="@form"/>
                            </HInputText>
                        </CWhen>
                        <COtherwise>
                            <!-- id card -->
                            <span class="iceOutTxt masInfoFieldLabel minindented">Id Card Number:</span>
                            <HInputText id="idCardNumberInput" maxlength="5"
                                        value="#{passengerFormBean.currentPassenger.idCardNumber}" required="true"
                                        requiredMessage="Insert your Id Card Number">
                                <FAjax event="blur" listener="#{passengerFormBean.passportIdListener}" execute="@this"
                                       render="@form"/>
                            </HInputText>
                        </COtherwise>
                    </CHhoose>
                    // TODO
                    <HGraphicImage id="helpIcon" library="images"
                                    name="icon_info.gif">
                        // TODO click event
                        <FAjax render="@all" event="click" listener="#{passengerFormBean.setPassportHelp}"/>
                    </HGraphicImage>
                </div>

                <div class="clear"/>
            </HPanelGroup>
            <!-- ajax for prefilling data when id exists -->
            <!-- validate numbers if existing check existing data for correctness -->
            <HPanelGroup id="personalDataContainer" layout="block"
                         styleClass="contentLevelContainer blockArea">
                <!-- if number exists show force edit button -->
                <CIf test="#{passengerFormBean.existingUser}">
                    <div class="indented inputFieldGroup">
                        <HCommandButton id="forceEditButton" value="Edit Data"
                                        styleClass="iceCmdBtn btnOption">
                            // TODO include in command button logic
                            <FAjax render="@form" execute="@this" listener="#{passengerFormBean.forceEditListener}"/>
                        </HCommandButton>
                    </div>
                </CIf>
                <!-- Firstname -->
                <div class="lFloat indented inputFieldGroup">
                    <span class="iceOutTxt masInfoFieldLabel minindented">Firstname:</span>
                    // TODO disabled
                    <HInputText id="firstNameInput"
                                 disabled="#{passengerFormBean.existingUser and !passengerFormBean.forceEdit}"
                                 value="#{passengerFormBean.currentPassenger.firstName}" required="true"
                                 requiredMessage="Insert your Firstname"/>
                </div>
                <!-- Lastname -->
                <div class="lFloat indented inputFieldGroup">
                    <span class="iceOutTxt masInfoFieldLabel minindented">Lastname:</span>
                    <HInputText id="lastNameInput"
                                disabled="#{passengerFormBean.existingUser and !passengerFormBean.forceEdit}"
                                value="#{passengerFormBean.currentPassenger.lastName}" required="true"
                                requiredMessage="Insert your Lastname"/>
                </div>
                <!-- Birthday with dp + converter -->
                <div class="lFloat indented inputFieldGroup">
                    <span class="iceOutTxt masInfoFieldLabel minindented">Birthdate:</span>
                    <HInputText id="birthDateInput"
                                disabled="#{passengerFormBean.existingUser and !passengerFormBean.forceEdit}"
                                value="#{passengerFormBean.currentPassenger.birthDay}" required="true"
                                requiredMessage="Insert your Birthdate"
                                converter="de.uni.frankfurt.ShortDateConverter"/>
                </div>
                <div class="clear"/>
            </HPanelGroup>

            <!-- luggage radio -->
            <HPanelGroup id="luggageContainer" layout="block"
                         styleClass="contentLevelContainer blockArea">
                <span class="iceOutTxt masInfoFieldLabel minindented">Select the desired amount of luggage</span>
                // TODO
                <h:selectOneRadio id="luggageRadio"
                                  styleClass="iceSelOneRb masInfoInputField" required="true"
                                  layout="pageDirection"
                                  requiredMessage="Select the amount of luggage you want to check in"
                                  value="#{passengerFormBean.currentPassenger.luggageCount}">
                    <FSelectItems id="luggageNumbers"
                                  value="#{passengerFormBean.luggageItems}"/>
                </h:selectOneRadio>
                <div class="clear"/>
                <HMessage styleClass="iceMsgError inputFieldLabel"
                          for="firstNameInput" id="firstNameErrorMessage"/>
                <HMessage styleClass="iceMsgError inputFieldLabel"
                          for="lastNameInput" id="lastNameErrorMessage"/>
                <HMessage styleClass="iceMsgError inputFieldLabel"
                          for="birthDateInput" id="birthDateErrorMessage"/>
                <HMessage styleClass="iceMsgError inputFieldLabel"
                          for="idCardNumberInput" id="idCardErrorMessage"/>
                <HMessage styleClass="iceMsgError inputFieldLabel"
                          for="passportNumberInput" id="passportErrorMessage"/>
            </HPanelGroup>

            <HCommandButton value="Cancel"
                             action="#{bookingBean.cancelBooking}"
                             id="cancelBookingButton"
                             styleClass="iceCmdBtn btnOption"/>
            // TODO immediate?
            <HCommandButton immediate="true" action="#{passengerFormBean.back}"
                             value="Back"
                             id="backButton"
                             styleClass="iceCmdBtn btnOption"/>
            <HCommandButton value="Continue"
                            id="continueButton"
                            action="#{passengerFormBean.next}"
                            styleClass="iceCmdBtn btnOption"/>

            // TODO
            <ice:panelPopup id="passportHelpPopup"
                            visible="#{passengerFormBean.passportHelp}" draggable="false"
                            styleClass="popup frameHolder" autoCentre="true">
                <FFacet name="body">
                    <div id="iFrameWrapper">
                        <ICEOutputText styleClass="iceOutTxt">
                            Your passport number should start with P and constist of 5 numbers <br/>
                            Your id card number should consist of 5 numbers
                        </ICEOutputText>
                    </div>
                </FFacet>
            </ice:panelPopup>
        </HForm>
    </ui:define>
</ui:composition>
</html>